{"version":3,"sources":["db-test.js"],"names":["test","require","Db","uuid","r","fixtures","utils","beforeEach","t","dbName","v4","db","connect","context","true","connected","afterEach","always","disconnect","false","conn","dbDrop","run","is","saveImage","image","getImage","created","url","description","deepEqual","tags","likes","liked","user_id","id","public_id","encode","truthy","createdAt","likeImage","creted","result","getImages","images","saveImages","map","sabeImage","img","Promise","all","length","saveUser","user","getUser","pass","password","name","email","username","encrypt"],"mappings":"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","file":"db-test.js","sourcesContent":["'use strict'\r\n/**\r\n * Import dependencies\r\n * @type\r\n *    test  Ava Depencie external,\r\n *    Db  Database Dependencie,\r\n *    uuid  Id genereted dependencie external,\r\n *    r  conection Db rethinksdb external,\r\n *    fixture  data default for test\r\n */\r\nconst test = require('ava')\r\nconst Db = require('../')\r\nconst uuid = require('uuid-base62')\r\nconst r = require('rethinkdb')\r\nconst fixtures = require('./fixtures/index')\r\nconst utils = require('../lib/utils')\r\n/**\r\n * Connection to DB\r\n */\r\ntest.beforeEach('setup db', async t => {\r\n  const dbName = `plazigram_${uuid.v4()}`\r\n  const db = new Db({db: dbName})\r\n  await db.connect()\r\n  t.context.db = db\r\n  t.context.dbName = dbName\r\n  t.true(db.connected, 'should be connect')\r\n})\r\n\r\n/**\r\n * Disconect to DB\r\n */\r\ntest.afterEach.always('cleanUp database', async t => {\r\n  let db = t.context.db\r\n  let dbName = t.context.dbName\r\n  await db.disconnect()\r\n  t.false(db.connected, 'should not be connect')\r\n  let conn = await r.connect({})\r\n  await r.dbDrop(dbName).run(conn)\r\n})\r\n/**\r\n * Testin for Save Images\r\n */\r\ntest('save image', async t => {\r\n  let db = t.context.db\r\n\r\n  t.is(typeof db.saveImage, 'function', 'saveImage is function')\r\n  let image = fixtures.getImage()\r\n  let created = await db.saveImage(image)\r\n  t.is(created.url, image.url)\r\n  t.is(created.description, image.description)\r\n  t.deepEqual(created.tags, ['awesome', 'tags'])\r\n  t.is(created.likes, image.likes)\r\n  t.is(created.liked, image.liked)\r\n  t.is(created.user_id, image.user_id)\r\n  t.is(typeof created.id, 'string')\r\n  t.is(created.public_id, uuid.encode(created.id))\r\n  t.truthy(created.createdAt)\r\n})\r\n/**\r\n * Testing add like image\r\n */\r\ntest('Like image', async t => {\r\n  let db = t.context.db\r\n  t.is(typeof db.likeImage, 'function', 'likeImage is a function')\r\n\r\n  let image = fixtures.getImage()\r\n  let creted = await db.saveImage(image)\r\n  let result = await db.likeImage(creted.public_id)\r\n\r\n  t.true(result.liked)\r\n  t.is(result.likes, image.likes + 1)\r\n})\r\n\r\n/**\r\n * Testin get Image\r\n */\r\ntest('Get image', async t => {\r\n  let db = t.context.db\r\n  t.is(typeof db.getImage, 'function', 'getImage is a function')\r\n\r\n  let image = fixtures.getImage(3)\r\n  let created = await db.saveImage(image)\r\n  let result = await db.getImage(created.public_id)\r\n\r\n  t.deepEqual(result, created)\r\n})\r\n/**\r\n * testing get images\r\n */\r\ntest('ist all Images', async t => {\r\n  let db = t.context.db\r\n  t.is(typeof db.getImages, 'function', 'getImages is a function')\r\n\r\n  let images = fixtures.getImages()\r\n  let saveImages = images.map(img => db.sabeImage(img))\r\n  let created = await Promise.all(saveImages)\r\n  let result = await db.getImages()\r\n  t.is(created.length, result.length)\r\n})\r\n/**\r\n * Testing Save User\r\n */\r\ntest('Save User', async t => {\r\n  let db = t.context.db\r\n  t.is(typeof db.saveUser, 'function', 'saveUser is funciont')\r\n\r\n  let user = fixtures.getUser()\r\n  let pass = user.password\r\n  let result = await db.saveUser(user)\r\n\r\n  t.is(user.name, result.name)\r\n  t.is(user.email, result.email)\r\n  t.is(user.username, result.username)\r\n  t.is(utils.encrypt(pass), result.password)\r\n  t.is(typeof result.id, 'string')\r\n  t.truthy(result.createdAt)\r\n})\r\n/**\r\n * Testing get User\r\n */\r\ntest('get user', async t => {\r\n  let db = t.context.db\r\n  t.is(typeof db.getUser, 'function', 'getUser is a function')\r\n\r\n  let user = fixtures.getUser()\r\n  let created = await db.saveUser(user)\r\n  let result = await db.getUser(user.username)\r\n\r\n  t.deepEqual(result, created)\r\n})\r\n"]}